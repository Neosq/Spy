-- Mobile Toggle - full reliable version (End file)

print("[Mobile Toggle] Starting creation...")

local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")

-- Create ScreenGui
local mobileToggle = Instance.new("ScreenGui")
mobileToggle.Name = "MobileToggle"
mobileToggle.ResetOnSpawn = false
mobileToggle.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
mobileToggle.Parent = CoreGui
print("[Mobile Toggle] ScreenGui created and parented to CoreGui")

-- Create button
local circleBtn = Instance.new("ImageButton")
circleBtn.Name = "ToggleBtn"
circleBtn.Size = UDim2.new(0, 60, 0, 60)
circleBtn.Position = UDim2.new(0.5, -30, 0.35, -30)  -- center + slightly upper
circleBtn.AnchorPoint = Vector2.new(0.5, 0.5)
circleBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 47)
circleBtn.BackgroundTransparency = 0.3
circleBtn.ImageTransparency = 0
circleBtn.ImageColor3 = Color3.new(1, 1, 1)
circleBtn.ZIndex = 10000
circleBtn.Visible = true

-- Public working eye icon
circleBtn.Image = "rbxassetid://7072718362"
print("[Mobile Toggle] Image set to: rbxassetid://7072718362 (eye icon)")

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(1)
corner.Parent = circleBtn

circleBtn.Parent = mobileToggle
print("[Mobile Toggle] Button added to ScreenGui")

-- Debug after 1 second
task.spawn(function()
    task.wait(1)
    print("[Debug] Button Position (UDim2): " .. tostring(circleBtn.Position))
    print("[Debug] Absolute Position: " .. tostring(circleBtn.AbsolutePosition))
    print("[Debug] Absolute Size: " .. tostring(circleBtn.AbsoluteSize))
    print("[Debug] Visible: " .. tostring(circleBtn.Visible))
    print("[Debug] ImageTransparency: " .. tostring(circleBtn.ImageTransparency))
    print("[Debug] ImageColor3: " .. tostring(circleBtn.ImageColor3))
end)

-- Click handler - reliable toggle with search
circleBtn.Activated:Connect(function()
    print("[Mobile Toggle] Button clicked!")
    
    local foundGui = nil
    for _, gui in ipairs(CoreGui:GetChildren()) do
        if gui:IsA("ScreenGui") and gui.Name:lower():find("simplespy") then
            foundGui = gui
            break
        end
    end
    
    if foundGui then
        foundGui.Enabled = not foundGui.Enabled
        print("[Mobile Toggle] Found GUI '" .. foundGui.Name .. "' - Enabled now: " .. tostring(foundGui.Enabled))
    else
        print("[Mobile Toggle] ERROR: No SimpleSpy GUI found in CoreGui! Check GUI file for ScreenGui name.")
    end
end)

-- Dragging
local dragging = false
local dragStart = nil
local startPos = nil

circleBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = circleBtn.Position
        print("[Debug] Drag started")
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        circleBtn.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

circleBtn.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
        print("[Debug] Drag ended")
    end
end)

print("[Mobile Toggle] Setup complete! Button should be visible in center-upper screen.")
